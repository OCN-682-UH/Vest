---
title: "Week_11_LectureNotes"
subtitle: Shinyyyyyy
format: html
---
[Cheatsheet](https://shiny.posit.co/r/articles/start/cheatsheet/)
[The Shiny Bible](https://mastering-shiny.org/)
[Webinar](https://github.com/rstudio/webinars/blob/master/47-introduction-to-shiny/intro-to-shiny.pdf)


Shiny link a regular website(UI) and your code(Server)
Useful to make your R code accessible to people outside R
* teaching a package

* showing data visualizations to non-experts

* streamlining certain code-intensive things (like database queries or visualizing bulky simulation outputs)
-example of HOBO logger interface to dump bulk raw data into a website and get it cleaned. Step up from downloading her package

### Examples of sharing digestible with broader community
Teaching population growth models
[Population Dynamics Lab](https://nsilbiger.shinyapps.io/PopulationDynamicsLab/)

Visualize model projections
[Marine Mammal Bycatch model](https://msiple.shinyapps.io/mmrefpoints/)
Siple et al. (2022) Journal of Open Source Software

## Starting a new Shiny app
Note: your Shiny app needs to be in its own folder and the foldername is the name of the app. It is really best for it to be its own standalone repo, but for today create your own folder in your lastname repo

### App template
library(shiny)
ui <- fluidPage()
server <- function (input, output) {}
shinyApp(ui = ui, server = server)

The *ui* (user interface) object dictates the appearance of the app. UI functions write HTML. For something to appear in your app, it needs to be in the UI.

The *server()* function contains rendering expressions that create the objects to display.

The server function and UI object are passed to the shinyApp() function to create a Shiny app object.

When saving the script in your app, create a folder with the name of your app and then save the script as *'app.R'*. You MUST save the script with this name for it to work. Also, all files associted with your app must be in this folder.

#### Add elements to app as arguements to fluid Page
```{r}
library(shiny)
ui<-fluidPage('Hello World')
server<-function(input,output){}
shinyApp(ui = ui, server = server)
```

### How to Start an app in RStudio
From The RStudio IDE, pick New File -> Shiny Web App

You can choose between single (app.R) or multiple files (ui.R and server.R)

Does it matter which one you choose?

  Not really. Some people like the organization of having multiple files. But it really doesn't make a difference!

This has a lot of helpful start code, but we are going to start from scratch today


### Build your app around *inputs* and *outputs*

```{r}
ui<-fluidPage(
   # Inputs functions,
   # Outputs functions
)
```
#### Create an input with an *input function*
There are many types of inputs and the syntax for all of them is typeInput. To make a slider we use sliderInput().

These inputs make a bunch of html code behind the scene.
```{r}
sliderInput(inputId = "num", # ID name for the input, notice Id
            label = "Choose a number", # Label above the input
            value = 25, min = 1, max = 100 # values for the slider
            )
```

Base
```{r}
library(shiny)
ui<-fluidPage()
server<-function(input,output){}
shinyApp(ui = ui, server = server)
```
With input
```{r}
library(shiny)
ui<-fluidPage(
  sliderInput(inputId = "num", # ID name for the input
            label = "Choose a number", # Label above the input
            value = 25, min = 1, max = 100 # values for the slider
            )
)
server<-function(input,output){}
shinyApp(ui = ui, server = server)
```

## Shiny Widgets!
[Widgets](https://shiny.posit.co/r/gallery/widgets/widget-gallery/)
[Even more widgets](https://dreamrs.github.io/shinyWidgets/)

With output
```{r}
library(shiny)
ui<-fluidPage(
  sliderInput(inputId = "num", # ID name for the input
            label = "Choose a number", # Label above the input
            value = 25, min = 1, max = 100 # values for the slider
            ), #you need this comma!
  plotOutput("hist") #creates space for a plot called hist
)
server<-function(input,output){}
shinyApp(ui = ui, server = server)
```
This code creates the space for a new plot, but nothing happens yet

#The Server
What is the server? Mostly, R code. This is where the vegan meat of your app is located.

Follow 3 Rules 

## 1. Save objects to display to outputs
```{r}
server<-function(input,output){
  output$hist <- # code
}
#Look back to the ui, hist is spelled identically to the name in the plotOutput() function
```
## 2. Build objects to display with render
```{r}
server<-function(input,output){
  output$hist <- renderPlot({
    # R code to make the hist output goes here
  })
}
```
Do what you know first. Start in RScript, make sure the plot works, bring it into Shiny
## 3. Access the input values with input

```{r}
library(shiny)
library(tidyverse) 
ui<-fluidPage(
  sliderInput(inputId = "num", # ID name for the input
            label = "Choose a number", # Label above the input
            value = 25, min = 1, max = 100 # values for the slider
            ),
  plotOutput("hist") #creates space for a plot called hist  
)
server<-function(input,output){
   output$hist <- renderPlot({
     # {} allows us to put all our R code in one nice chunck
    data<-tibble(x = rnorm(input$num)) # 100 random normal points
    ggplot(data, aes(x = x))+ # make a histogram 
      geom_histogram() 
  })
}
```

## Let's add two types of inputs
Let's say we want to write an input where the user can create whatever title they want by typing it into a box. Let's update our ui to have a textInput.
```{r}
ui<-fluidPage(
  sliderInput(inputId = "num", # ID name for the input 
            label = "Choose a number", # Label above the input
            value = 25, min = 1, max = 100 # values for the slider
            ),
  textInput(inputId = "title", # new Id is title
          label = "Write a title",
          value = "Histogram of Random Normal Values"), # starting title
  plotOutput("hist") #creates space for a plot called hist  
)
```
Now let's update the server to change the title of the plot
```{r}
server<-function(input,output){
   output$hist <- renderPlot({
     # {} allows us to put all our R code in one nice chunck
    data<-tibble(x = rnorm(input$num)) # 100 random normal points 
    ggplot(data, aes(x = x))+ # make a histogram 
      geom_histogram() +
      labs(title = input$title) #Add a new title
  })
}
```
## Create two outputs
Let's say we want to add a data table below the histogram that has all the summary statistics. We need to add another ui that creates a place to put the table. We will use verbatimTextOutput()
```{r}
ui<-fluidPage(
  sliderInput(inputId = "num", # ID name for the input 
            label = "Choose a number", # Label above the input
            value = 25, min = 1, max = 100 # values for the slider
            ),
  textInput(inputId = "title", # new Id is title 
          label = "Write a title",
          value = "Histogram of Random Normal Values"), # starting title 
  plotOutput("hist"), #creates space for a plot called hist
  verbatimTextOutput("stats") # create a space for stats
)
```
### Now update the server to calculate the summary stats
Here we use renderPrint
```{r}
server<-function(input,output){
   output$hist <- renderPlot({
     # {} allows us to put all our R code in one nice chunck
    data<-tibble(x = rnorm(input$num)) # 100 random normal points 
    ggplot(data, aes(x = x))+ # make a histogram 
      geom_histogram() +
      labs(title = input$title) #Add a new title
  })
   output$stats <- renderPrint({
     summary(rnorm(input$num)) # calculate summary stats based on the numbers
     })
}
```
## Cleaning the code
Here, we used input$num twice: once in the plot and once in the summary stats. This actually created two separate random distributions and the stats actually are not directly related to the plots. We need to build a reactive object so the same dataframe is being used throughout all the code.
A reactive object can be called like a function
data()
Reactive expressions cache their values making your app run much faster
```{r}
library(shiny)
library(tidyverse)
ui<-fluidPage(
  sliderInput(inputId = "num", # ID name for the input
              label = "Choose a number", # Label above the input
              value = 25, min = 1, max = 100 # values for the slider
  ), 
  textInput(inputId = "title", # new Id is title
            label = "Write a title", #
            value = "Histogram of Random Normal Values"), # starting title
  plotOutput("hist"), #creates space for a plot called hist  
  verbatimTextOutput("stats") # create a space for stats
)
server<-function(input,output){
  output$hist <- renderPlot({
    # {} 
    data<-tibble(x = rnorm(input$num)) # 100 random normal points
    ggplot(data, aes(x = x))+ # make a histogram
      geom_histogram()+
      labs(title = input$title) #Add a new title
  )}
}
```
and then...
```{r}
library(shiny)
library(tidyverse)
ui<-fluidPage(
  sliderInput(inputId = "num", # ID name for the input
              label = "Choose a number", # Label above the input
              value = 25, min = 1, max = 100 # values for the slider
  ), 
  textInput(inputId = "title", # new Id is title
            label = "Write a title", #
            value = "Histogram of Random Normal Values"), # starting title
  plotOutput("hist"), #creates space for a plot called hist  
  verbatimTextOutput("stats") # create a space for stats
)
server<-function(input,output){
  data<-reactive({
     tibble(x = rnorm(input$num)) # 100 random normal points
  })
  output$hist <- renderPlot({
    ggplot(data, aes(x = x))+ # make a histogram
      geom_histogram()+
```
Reactive object: Use data()
```{r}
server<-function(input,output){
  data<-reactive({ 
     tibble(x = rnorm(input$num)) # 100 random normal points
  }) 
  output$hist <- renderPlot({
    ggplot(data(), aes(x = x))+ # make a histogram
      geom_histogram()+
      labs(title = input$title) #Add a new title
  })
  output$stats <- renderPrint({
    summary(data()) # calculate summary stats based on the numbers
  })
}
shinyApp(ui = ui, server = server)
```
Build one thing at a time and test it every step

# Publish a Shiny app for free
Deploy your app either by pressing "publish" or deploying in the console
# do this in the console after you already ran you shiny app
library(rsconnect)
deployApp() ## re-run this or republish after every update you make to your code

# Flair 
[Theme](https://rstudio.github.io/shinythemes/)
[Dashboards](https://rstudio.github.io/shinydashboard/)
